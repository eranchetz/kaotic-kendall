<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kaotic Kendall — Office Chaos</title>
<style>
  :root{
    --orange:#ea5b1b;
    --orange-dark:#c24611;
    --cream:#ffe5c7;
    --ink:#15202b;
    --gold:#ffcf4d;
    --brown:#7b4b2a;
    --green:#1fbf72;
    --red:#ff3d3d;
  }
  html,body{height:100%;margin:0;font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";}
  body{
    color:#111;
    /* Poster-style burst background */
    background:
      radial-gradient(ellipse at center, rgba(255,255,255,0.06) 0 30%, transparent 31%),
      repeating-conic-gradient(from 0deg, rgba(255,255,255,0.12) 0 6deg, transparent 6deg 12deg),
      radial-gradient(circle at 50% 35%, #f27b3e 0 40%, transparent 41%),
      linear-gradient(180deg, var(--orange) 0%, var(--orange-dark) 100%);
    background-blend-mode: soft-light, normal, normal, normal;
  }
  /* Layout */
  .wrap{
    max-width: 960px;
    margin: 0 auto;
    height:100%;
    display:flex;
    flex-direction:column;
    padding: 16px;
    box-sizing:border-box;
  }

  header{
    text-align:center;
    color:#ffe8d5;
    text-shadow: 0 2px 0 #0008, -1px -1px 0 #0008, 1px -1px 0 #0008, -1px 1px 0 #0008, 1px 1px 0 #0008;
    letter-spacing: .5px;
  }
  .title{
    font-weight: 900;
    font-size: clamp(28px, 6.5vw, 56px);
    margin:4px 0 2px;
  }
  .tag{
    font-weight: 800;
    font-size: clamp(12px,2.8vw,18px);
    margin: 0 0 6px;
  }

  #hud{
    display:flex; gap:10px; align-items:center; justify-content:space-between;
    background: rgba(255,255,255,.15);
    border: 2px solid #0004;
    border-radius: 10px;
    padding: 8px 10px;
    box-shadow: inset 0 2px 0 #fff2, 0 6px 0 #0002;
    color:#fff;
    text-shadow: 0 1px 0 #0009;
    user-select:none;
  }
  .pill{display:inline-flex;align-items:center;gap:8px;padding:4px 8px;border-radius:999px;background:#0005}
  .stat{font-weight:800}
  .bar{
    position:relative; height:14px; width:min(360px,40vw);
    background:#0006; border-radius:999px; overflow:hidden; border:1px solid #0007;
  }
  .bar>i{display:block; height:100%; width:0%; background:linear-gradient(90deg, #74e39a, #1fbf72); transition:width .15s}
  .bar.stress>i{background:linear-gradient(90deg, #ffb347, #ff3d3d);}
  #game{
    position:relative; flex:1; margin-top:10px; overflow:hidden;
    border: 4px solid #0006; border-radius: 16px;
    background: radial-gradient(circle at 70% 10%, #ffddb9 0, #fec794 25%, #f7a269 50%, #f07d41 70%, #e15f23 100%);
    box-shadow: inset 0 10px 0 #fff3, inset 0 -10px 0 #0001, 0 16px 0 #0002;
    touch-action: none; /* enables PointerEvents gestures */
  }

  /* Buttons / overlays */
  .btn{
    background: linear-gradient(#ffd86b, #ffb347);
    border: 0; padding: 12px 18px; border-radius: 10px;
    font-weight: 900; letter-spacing:.5px; cursor:pointer;
    box-shadow: 0 4px 0 #b46f00, inset 0 2px 0 #fff7;
  }
  .btn:active{ transform: translateY(2px); box-shadow: 0 2px 0 #b46f00, inset 0 2px 0 #fff7; }

  #startScreen, #gameOver{
    position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
    background: linear-gradient(180deg, #00000090, #000000b5);
    color:#fff; text-align:center; padding: 24px; gap:14px;
    z-index: 1000;
  }
  #startScreen h1, #gameOver h1{margin:0;text-shadow:0 2px 0 #000;}
  .kbd{background:#fff2;padding:2px 6px;border-radius:6px;border:1px solid #fff3}

  /* Task items */
  .task{
    position:absolute;
    display:flex; align-items:center; justify-content:center; flex-direction:column; gap:4px;
    min-width:72px; min-height:72px; width:84px; height:84px; border-radius:14px;
    border: 2px solid #0007;
    box-shadow: 0 6px 0 #0002, inset 0 2px 0 #fff8;
    background:#fff8;
    user-select:none;
    transform: scale(.95);
    animation: pop-in .12s ease-out forwards;
  }
  @keyframes pop-in{to{transform:scale(1)}}
  .task .icon{font-size:38px; line-height:1}
  .task .label{font-size:12px; font-weight:800; color:#333; text-shadow:0 1px 0 #fff}
  .task .ring{
    position:absolute; inset:-6px; border-radius:16px; border:6px solid #0000; pointer-events:none;
    --c: #0000 60%, #ffe66a 0 70%, #0000 0;
    background:
      conic-gradient(var(--c)),
      conic-gradient(var(--c));
    background-size:50% 100%; background-repeat:no-repeat; opacity:.85;
  }
  .task.phone{background:#fff; border-color:#1d3557; }
  .task.laptop{background:#fff; border-color:#9b2226;}
  .task.coworker{background:#fff; border-color:#264653;}
  .task.spill{background: #e6d3c5; border-color:#5a3b23;}
  .shake{animation:shake .2s linear 3}
  @keyframes shake{25%{transform:translateX(-3px)}50%{transform:translateX(3px)}75%{transform:translateX(-3px)}}

  /* Mini progress for hold/scrub */
  .progress{
    position:absolute; left:8px; right:8px; bottom:6px; height:8px; border-radius:999px;
    background:#0002; border:1px solid #0003; overflow:hidden;
  }
  .progress>i{display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--gold), #ff6a3d); transition: width .06s;}

  /* Coffee spill visual */
  .spill .blob{
    position:absolute; width:60px; height:40px; border-radius:50% 43% 55% 52% / 60% 40% 60% 45%;
    background: radial-gradient(circle at 35% 35%, #85522f, #6d3f22 55%, #5b3520 100%);
    filter: drop-shadow(0 3px 0 #0002);
    transform: rotate(-7deg);
  }

  /* Toaster notifications */
  #toast{
    position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
    background:#000b; color:#fff; padding:8px 12px; border-radius:8px; font-weight:700; display:none;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="tag">They’re just not doing their job!</div>
      <div class="title">KAOTIC KENDALL — OFFICE CHAOS</div>
    </header>

    <div id="hud">
      <div class="pill">Score: <span id="score" class="stat">0</span></div>
      <div class="pill">Time: <span id="time" class="stat">60</span>s</div>
      <div class="bar" title="Energy (keep it up!)"><i id="energyFill"></i></div>
      <div class="bar stress" title="Stress (don’t let it fill!)"><i id="stressFill"></i></div>
      <button id="pauseBtn" class="btn" aria-label="Pause">Pause</button>
    </div>

    <div id="game" aria-label="Game field">
      <div id="startScreen">
        <h1>Be Kendall. Beat the Chaos.</h1>
        <div>Fix issues before stress maxes out. Win points. Simple.</div>
        <ul style="text-align:left;max-width:560px;line-height:1.35">
          <li><b>Phones</b> 📞 — tap to answer.</li>
          <li><b>Laptop errors</b> 💻❗ — press & hold to fix.</li>
          <li><b>Coworkers</b> 🙉 — tap 3× to calm.</li>
          <li><b>Coffee spills</b> ☕ — click/drag to scrub clean.</li>
        </ul>
        <div>Hints: <span class="kbd">Space</span> to pause. Difficulty rises every 15 s.</div>
        <button id="startBtn" class="btn" style="font-size:18px">Start Game</button>
      </div>
      <div id="gameOver" style="display:none">
        <h1>Game Over</h1>
        <div id="finalStats"></div>
        <button id="restartBtn" class="btn" style="font-size:18px">Play Again</button>
      </div>
      <div id="toast"></div>
    </div>
  </div>

<script>
/* ========= Core Game State ========= */
const gameEl = document.getElementById('game');
const scoreEl = document.getElementById('score');
const timeEl = document.getElementById('time');
const energyFill = document.getElementById('energyFill');
const stressFill = document.getElementById('stressFill');
const startScreen = document.getElementById('startScreen');
const gameOverEl = document.getElementById('gameOver');
const finalStatsEl = document.getElementById('finalStats');
const pauseBtn = document.getElementById('pauseBtn');
const toast = document.getElementById('toast');

let audioCtx;
const now = ()=> audioCtx ? audioCtx.currentTime : 0;
function beep({freq=600, duration=0.07, type='square', gain=0.03}={}){
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    const t = audioCtx.currentTime;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.setValueAtTime(freq, t);
    g.gain.value = gain;
    o.connect(g).connect(audioCtx.destination);
    o.start();
    o.stop(t + duration);
  }catch{}
}

const RAND = (min,max)=> Math.random()*(max-min)+min;
const CHANCE = p=> Math.random()<p;

const state = {
  running:false, paused:false,
  score:0, time:60,
  stress:10, energy:100,
  spawnMs:3000, minSpawnMs:450,
  lastSpawn:0, levelTick:0,
  tasks:new Set(),
  timers:new Set()
};

function reset(){
  state.running=false; state.paused=false;
  state.score=0; state.time=60;
  state.stress=10; state.energy=100;
  state.spawnMs=1500; state.minSpawnMs=600; state.levelTick=0;
  scoreEl.textContent=state.score;
  timeEl.textContent=state.time;
  energyFill.style.width = state.energy + '%';
  stressFill.style.width = state.stress + '%';
  // clear tasks/timers
  [...state.tasks].forEach(t=>t.destroy(true));
  state.tasks.clear();
  state.timers.forEach(id=>clearInterval(id) || clearTimeout(id));
  state.timers.clear();
}

/* ========= Task Factory ========= */
const TYPES = {
  phone:{
    emoji:'📞', label:'Answer!', ttl: 4200, reward: 8, penalty: 13,
    init(task){
      task.el.addEventListener('pointerdown', ()=> task.resolve());
    }
  },
  laptop:{
    emoji:'💻', label:'Fix bug', ttl: 6200, reward: 15, penalty: 16,
    holdNeeded: 900, // ms
    init(task){
      const prog = document.createElement('div'); prog.className='progress';
      const fill = document.createElement('i'); prog.appendChild(fill);
      task.el.appendChild(prog);
      let holdStart=0, rAF=null;
      const onDown = (e)=>{
        e.preventDefault();
        holdStart = performance.now();
        const loop = ()=>{
          const pct = Math.min(100, (performance.now()-holdStart)/this.holdNeeded*100);
          fill.style.width = pct + '%';
          rAF = pct>=100 ? (task.resolve(), null) : requestAnimationFrame(loop);
        };
        rAF = requestAnimationFrame(loop);
      };
      const onUp = ()=> { if(rAF) cancelAnimationFrame(rAF); rAF=null; fill.style.width='0%'; };
      task.el.addEventListener('pointerdown', onDown);
      window.addEventListener('pointerup', onUp);
      task.onDestroy = ()=> window.removeEventListener('pointerup', onUp);
    }
  },
  coworker:{
    emoji:'🙉', label:'Calm 3×', ttl: 5400, reward: 12, penalty: 14,
    init(task){
      let taps=0;
      task.el.addEventListener('pointerdown', ()=>{
        taps++;
        task.pulse();
        beep({freq: 450 + taps*60, duration:0.05, type:'sine', gain:0.02});
        if(taps>=3) task.resolve();
        else task.setLabel(`Calm ${3-taps}×`);
      });
    }
  },
  spill:{
    emoji:'☕', label:'Scrub!', ttl: 5000, reward: 10, penalty: 12,
    init(task){
      // Big coffee blob
      const blob = document.createElement('div'); blob.className='blob'; task.el.appendChild(blob);
      const prog = document.createElement('div'); prog.className='progress';
      const fill = document.createElement('i'); prog.appendChild(fill); task.el.appendChild(prog);
      let scrubbing=false, dist=0, last=null;
      const onDown = (e)=>{ scrubbing=true; last=[e.clientX,e.clientY]; };
      const onMove = (e)=>{
        if(!scrubbing) return;
        const d = Math.hypot(e.clientX-last[0], e.clientY-last[1]); last=[e.clientX,e.clientY];
        dist += d;
        fill.style.width = Math.min(100, dist/180*100)+'%';
        if(dist>=180) task.resolve();
      };
      const onUp = ()=> scrubbing=false;
      task.el.addEventListener('pointerdown', onDown);
      task.el.addEventListener('pointermove', onMove);
      window.addEventListener('pointerup', onUp);
      task.onDestroy = ()=> window.removeEventListener('pointerup', onUp);
    }
  }
};

class Task {
  constructor(type){
    this.type = type;
    this.spec = TYPES[type];
    this.created = performance.now();
    this.el = document.createElement('div');
    this.el.className = `task ${type}`;
    this.el.style.left = Math.round(RAND(6, gameEl.clientWidth-100))+'px';
    this.el.style.top  = Math.round(RAND(6, gameEl.clientHeight-100))+'px';

    const ring = document.createElement('div'); ring.className='ring';
    this.el.appendChild(ring);

    const icon = document.createElement('div'); icon.className='icon'; icon.textContent=this.spec.emoji;
    const label = document.createElement('div'); label.className='label'; label.textContent=this.spec.label;
    this.el.append(icon,label);

    gameEl.appendChild(this.el);
    state.tasks.add(this);

    // Timeout for failure
    this.expireId = setTimeout(()=> this.fail(), this.spec.ttl);
    state.timers.add(this.expireId);

    // Attach interactions
    this.spec.init(this);
  }
  setLabel(text){ this.el.querySelector('.label').textContent = text; }
  pulse(){ this.el.classList.remove('shake'); void this.el.offsetWidth; this.el.classList.add('shake'); }
  resolve(){
    if(this.resolved) return;
    this.resolved = true;
    clearTimeout(this.expireId); state.timers.delete(this.expireId);
    addScore(this.spec.reward);
    adjustEnergy(+3);
    adjustStress(-5);
    toastMsg(['Nice save!','Crisis averted!','On it!'][Math.floor(Math.random()*3)]);
    beep({freq:760, duration:.09, type:'triangle', gain:.035});
    this.destroy();
  }
  fail(){
    if(this.resolved) return;
    this.pulse();
    adjustStress(+this.spec.penalty);
    adjustEnergy(-6);
    beep({freq:220, duration:.12, type:'sawtooth', gain:.04});
    this.destroy();
  }
  destroy(instantly){
    if(this.onDestroy) try{this.onDestroy();}catch{}
    state.tasks.delete(this);
    if(instantly){ this.el.remove(); return; }
    this.el.style.transition='transform .14s, opacity .14s';
    this.el.style.transform='scale(.8) rotate(-6deg)';
    this.el.style.opacity='0';
    setTimeout(()=> this.el.remove(), 160);
  }
}

/* ========= Game Flow ========= */
function spawnOne(){
  if(!state.running || state.paused) return;
  const r = Math.random();
  const type = r<.28 ? 'phone' : r<.52 ? 'laptop' : r<.78 ? 'coworker' : 'spill';
  new Task(type);
}

function addScore(n){ state.score+=n; scoreEl.textContent=state.score; }

function adjustStress(n){
  state.stress = Math.max(0, Math.min(100, state.stress + n));
  stressFill.style.width = state.stress + '%';
  if(state.stress>=100) return endGame('Stress overload! The office imploded.');
}

function adjustEnergy(n){
  state.energy = Math.max(0, Math.min(100, state.energy + n));
  energyFill.style.width = state.energy + '%';
}

function startGame(){
  reset();
  startScreen.style.display='none';
  gameOverEl.style.display='none';
  state.running=true;
  beep({freq:520, duration:.14, type:'sine', gain:.05});

  // Main timers
  const secTimer = setInterval(()=>{
    if(!state.running || state.paused) return;
    state.time--; timeEl.textContent=state.time;
    if(state.time<=0) endGame('Shift complete. Chaos contained.');
  }, 1000);

  
  const diffTimer = setInterval(()=>{
    if(!state.running) return;
    // Smooth difficulty curve: shrink spawn interval by 12% every 8s
    state.spawnMs = Math.max(state.minSpawnMs, state.spawnMs * 0.88);
  }, 8000);

  // Micro scheduler that spawns according to dynamic spawnMs
  let last = performance.now();
  function tick(){
    if(!state.running) return;
    const t = performance.now();
    if(!state.paused && (t-last)>=state.spawnMs){
      spawnOne(); last=t;
    }
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  state.timers.add(secTimer); state.timers.add(diffTimer);
}

function endGame(reason){
  state.running=false;
  gameOverEl.style.display='flex';
  finalStatsEl.innerHTML = `<p>${reason}</p>
    <p><b>Score:</b> ${state.score} &nbsp; • &nbsp; <b>Time left:</b> ${state.time}s</p>`;
}

function togglePause(){
  if(!state.running) return;
  state.paused = !state.paused;
  pauseBtn.textContent = state.paused ? 'Resume' : 'Pause';
  toastMsg(state.paused ? 'Paused' : 'Resume');
  beep({freq: state.paused?300:600, duration:.06, type:'square', gain:.03});
}

/* ========= UI / Helpers ========= */
function toastMsg(msg){
  toast.textContent = msg;
  toast.style.display='block';
  toast.style.opacity='1';
  clearTimeout(toast._id);
  toast._id = setTimeout(()=>{
    toast.style.transition='opacity .5s';
    toast.style.opacity='0';
    setTimeout(()=>{toast.style.display='none'; toast.style.transition='';}, 520);
  }, 700);
}

/* ========= Wire up ========= */
document.getElementById('startBtn').addEventListener('click', startGame);
document.getElementById('restartBtn').addEventListener('click', startGame);
pauseBtn.addEventListener('click', togglePause);
window.addEventListener('keydown', (e)=>{ if(e.code==='Space'){ e.preventDefault(); togglePause(); }});

/* Accessibility: enable audio on first interaction on iOS */
window.addEventListener('pointerdown', ()=>{ if(!audioCtx) try{audioCtx = new (window.AudioContext||window.webkitAudioContext)();}catch{} }, {once:true});
</script>
</body>
</html>
